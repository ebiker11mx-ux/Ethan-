                                    #!/usr/bin/env bash
set -euo pipefail

# Create structure
mkdir -p whatsapp-web-plus/{backend,frontend/src/components}
cd whatsapp-web-plus

##################################
# Backend files
##################################
cat > backend/package.json <<'EOF'
{
  "name": "whatsapp-web-plus-backend",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "dev": "node server.js",
    "start": "node server.js"
  },
  "dependencies": {
    "dotenv": "^16.4.5",
    "express": "^4.19.2",
    "node-fetch": "^3.3.2",
    "ws": "^8.18.0",
    "cors": "^2.8.5",
    "morgan": "^1.10.0",
    "body-parser": "^1.20.2"
  }
}
EOF

cat > backend/.env.example <<'EOF'
PORT=3001
VERIFY_TOKEN=replace-with-a-random-string
WHATSAPP_TOKEN=replace-with-your-permanent-access-token
PHONE_NUMBER_ID=replace-with-your-phone-number-id
EOF

cat > backend/db.js <<'EOF'
// Simple in-memory store (swap with Postgres later)
export const db = {
  contacts: new Map(),
  conversations: new Map(),
  messages: new Map(),
};

export function getConvId(phone) {
  return `conv_${phone}`;
}

export function upsertContact(phone, displayName) {
  const c = db.contacts.get(phone) || { phone, displayName: displayName || phone, labels: [], lastSeen: null };
  c.displayName = displayName || c.displayName;
  c.lastSeen = Date.now();
  db.contacts.set(phone, c);
  return c;
}

export function upsertConversation(phone) {
  const id = getConvId(phone);
  const existing = db.conversations.get(id);
  if (!existing) {
    db.conversations.set(id, {
      id, phone, assignedTo: null, pinned: false, status: 'open', lastMessageAt: Date.now()
    });
    db.messages.set(id, []);
  } else {
    existing.lastMessageAt = Date.now();
  }
  return db.conversations.get(id);
}

export function addMessage(phone, msg) {
  const convId = getConvId(phone);
  upsertConversation(phone);
  const arr = db.messages.get(convId);
  const record = { id: `${convId}_${arr.length + 1}`, createdAt: Date.now(), ...msg };
  arr.push(record);
  db.conversations.get(convId).lastMessageAt = record.createdAt;
  return record;
}

export function listConversations() {
  return Array.from(db.conversations.values()).sort((a, b) => b.lastMessageAt - a.lastMessageAt);
}

export function getThread(convId) {
  return db.messages.get(convId) || [];
}
EOF

cat > backend/server.js <<'EOF'
import 'dotenv/config';
import express from 'express';
import bodyParser from 'body-parser';
import fetch from 'node-fetch';
import cors from 'cors';
import morgan from 'morgan';
import { WebSocketServer } from 'ws';
import { db, upsertContact, upsertConversation, addMessage, listConversations, getThread, getConvId } from './db.js';

const app = express();
app.use(cors());
app.use(morgan('dev'));
app.use(bodyParser.json());

const PORT = process.env.PORT || 3001;
const VERIFY_TOKEN = process.env.VERIFY_TOKEN;
const WHATSAPP_TOKEN = process.env.WHATSAPP_TOKEN;
const PHONE_NUMBER_ID = process.env.PHONE_NUMBER_ID;

// WebSocket for realtime updates
const wss = new WebSocketServer({ noServer: true });
const sockets = new Set();

function broadcast(event, payload) {
  const msg = JSON.stringify({ event, payload });
  for (const ws of sockets) {
    try { ws.send(msg); } catch {}
  }
}

const server = app.listen(PORT, () => console.log(`Backend listening on :${PORT}`));
server.on('upgrade', (req, socket, head) => {
  if (req.url !== '/ws') {
    socket.destroy();
    return;
  }
  wss.handleUpgrade(req, socket, head, (ws) => {
    sockets.add(ws);
    ws.on('close', () => sockets.delete(ws));
  });
});

// Health
app.get('/health', (_, res) => res.json({ ok: true }));

// Webhook verification
app.get('/webhook', (req, res) => {
  const mode = req.query['hub.mode'];
  const token = req.query['hub.verify_token'];
  const challenge = req.query['hub.challenge'];
  if (mode === 'subscribe' && token === VERIFY_TOKEN) {
    return res.status(200).send(challenge);
  }
  return res.sendStatus(403);
});

// Receive messages webhook
app.post('/webhook', async (req, res) => {
  try {
    const entry = req.body.entry?.[0];
    const change = entry?.changes?.[0]?.value;
    const messages = change?.messages || [];
    const contacts = change?.contacts || [];

    messages.forEach((msg) => {
      const from = msg.from;
      const profileName = contacts?.[0]?.profile?.name;
      upsertContact(from, profileName);
      upsertConversation(from);

      const type = msg.type;
      let body = '';
      let mediaUrl = null;
      if (type === 'text') body = msg.text?.body || '';
      else if (type === 'image') mediaUrl = msg.image?.link;
      else if (type === 'audio') mediaUrl = msg.audio?.link;
      else if (type === 'document') mediaUrl = msg.document?.link;
      else body = `[${type}]`;

      const saved = addMessage(from, {
        direction: 'in',
        type,
        body,
        mediaUrl,
        status: 'received'
      });

      broadcast('message:new', { conversationId: getConvId(from), message: saved });
    });

    res.sendStatus(200);
  } catch (e) {
    console.error('Webhook error', e);
    res.sendStatus(200);
  }
});

// List conversations
app.get('/conversations', (req, res) => {
  res.json(listConversations().map(c => ({
    ...c,
    contact: db.contacts.get(c.phone) || { phone: c.phone, displayName: c.phone }
  })));
});

// Thread by conversation ID
app.get('/conversations/:id', (req, res) => {
  const convId = req.params.id;
  const conv = db.conversations.get(convId);
  if (!conv) return res.status(404).json({ error: 'Not found' });
  const contact = db.contacts.get(conv.phone) || { phone: conv.phone, displayName: conv.phone };
  res.json({ conversation: conv, contact, messages: getThread(convId) });
});

// Send message
app.post('/send', async (req, res) => {
  const { to, text } = req.body;
  if (!to || !text) return res.status(400).json({ error: 'Missing to or text' });

  const url = `https://graph.facebook.com/v21.0/${PHONE_NUMBER_ID}/messages`;
  const payload = { messaging_product: 'whatsapp', to, text: { body: text } };

  try {
    const r = await fetch(url, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${WHATSAPP_TOKEN}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(payload)
    });
    const json = await r.json();

    upsertContact(to);
    upsertConversation(to);
    const saved = addMessage(to, {
      direction: 'out',
      type: 'text',
      body: text,
      status: r.ok ? 'sent' : 'error'
    });
    broadcast('message:new', { conversationId: getConvId(to), message: saved });

    return res.status(r.ok ? 200 : 400).json(json);
  } catch (e) {
    console.error('Send error', e);
    return res.status(500).json({ error: 'Send failed' });
  }
});
EOF

##################################
# Frontend files
##################################
cat > frontend/package.json <<'EOF'
{
  "name": "whatsapp-web-plus-frontend",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview --port 4173"
  },
  "dependencies": {
    "react": "^18.3.1",
    "react-dom": "^18.3.1"
  },
  "devDependencies": {
    "vite": "^5.4.0"
  }
}
EOF

cat > frontend/vite.config.js <<'EOF'
export default {
  server: { port: 5173 }
};
EOF

cat > frontend/index.html <<'EOF'
<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>WhatsApp Web Plus</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
EOF

cat > frontend/src/styles.css <<'EOF'
:root {
  --bg: #0b141a;
  --panel: #111b21;
  --text: #e9edef;
  --muted: #8696a0;
  --accent: #25d366;
  --bubble-in: #202c33;
  --bubble-out: #005c4b;
}
* { box-sizing: border-box; }
body { margin: 0; background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }
.app { display: grid; grid-template-columns: 360px 1fr; height: 100vh; }
.sidebar { background: var(--panel); border-right: 1px solid #222; overflow: auto; }
.header { padding: 12px; border-bottom: 1px solid #222; display: flex; gap: 8px; align-items: center; }
.search { flex: 1; background: #1f2b33; border: none; color: var(--text); padding: 8px; border-radius: 6px; }
.item { width: 100%; text-align: left; padding: 12px; border-bottom: 1px solid #222; background: transparent; color: var(--text); cursor: pointer; }
.item:hover { background: #162029; }
.name { font-weight: 600; }
.preview { color: var(--muted); font-size: 12px; }
.meta { color: var(--muted); font-size: 12px; margin-top: 4px; }
.thread { display: grid; grid-template-rows: auto 56px; height: 100vh; }
.messages { padding: 16px; overflow: auto; display: flex; flex-direction: column; gap: 8px; }
.msg { max-width: 70%; padding: 8px 12px; border-radius: 10px; position: relative; }
.msg.in { align-self: flex-start; background: var(--bubble-in); }
.msg.out { align-self: flex-end; background: var(--bubble-out); }
.body { white-space: pre-wrap; word-break: break-word; }
.time { font-size: 11px; color: var(--muted); margin-top: 6px; text-align: right; }
.composer { background: var(--panel); border-top: 1px solid #222; display: flex; gap: 8px; align-items: center; padding: 8px; }
.textarea { flex: 1; background: #1f2b33; border: none; color: var(--text); padding: 10px; border-radius: 6px; resize: none; height: 40px; }
.button { background: var(--accent); color: black; border: none; padding: 8px 12px; border-radius: 6px; cursor: pointer; }
.button:disabled { opacity: 0.6; cursor: not-allowed; }
.rightpanel { display: none; }
EOF

cat > frontend/src/api.js <<'EOF'
const API = { base: 'http://localhost:3001' };

export async function fetchConversations() {
  const r = await fetch(`${API.base}/conversations`);
  return r.json();
}
export async function fetchThread(id) {
  const r = await fetch(`${API.base}/conversations/${id}`);
  if (!r.ok) throw new Error('Not found');
  return r.json();
}
export async function sendMessage(to, text) {
  const r = await fetch(`${API.base}/send`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ to, text })
  });
  const json = await r.json();
  return { ok: r.ok, json };
}
export function connectWS(onEvent) {
  const ws = new WebSocket(`ws://localhost:3001/ws`);
  ws.onmessage = (ev) => {
    try { onEvent?.(JSON.parse(ev.data)); } catch {}
  };
  return ws;
}
EOF

cat > frontend/src/store.js <<'EOF'
import { fetchConversations, fetchThread, connectWS } from './api';

export class Store {
  constructor(onChange) {
    this.onChange = onChange;
    this.state = { conversations: [], activeId: null, activeThread: null, search: '' };
    this.ws = null;
  }
  async load() {
    this.state.conversations = await fetchConversations();
    if (this.state.conversations[0]) {
      this.setActive(this.state.conversations[0].id);
    } else {
      this.onChange(this.state);
    }
    this.ws = connectWS((evt) => this.handleWS(evt));
  }
  async setActive(id) {
    this.state.activeId = id;
    this.state.activeThread = await fetchThread(id);
    this.onChange(this.state);
  }
  handleWS(evt) {
    if (evt.event === 'message:new') {
      const { conversationId, message } = evt.payload;
      const conv = this.state.conversations.find(c => c.id === conversationId);
      if (conv) conv.lastMessageAt = message.createdAt;
      if (this.state.activeId === conversationId && this.state.activeThread) {
        this.state.activeThread.messages.push(message);
        this.onChange(this.state);
      }
    }
  }
  setSearch(q) { this.state.search = q; this.onChange(this.state); }
}
EOF

cat > frontend/src/components/Sidebar.jsx <<'EOF'
import React from 'react';

export default function Sidebar({ conversations, search, onSearch, onSelect }) {
  const filtered = conversations.filter(c => {
    const name = c.contact?.displayName || c.phone;
    const last = c.lastMessageAt ? new Date(c.lastMessageAt).toLocaleString() : '';
    return name.toLowerCase().includes(search.toLowerCase()) || last.includes(search);
  });

  return (
    <div className="sidebar">
      <div className="header">
        <input className="search" placeholder="Search contacts…" value={search} onChange={e => onSearch(e.target.value)} />
        <button className="button" onClick={() => location.reload()}>Refresh</button>
      </div>
      <div>
        {filtered.map(c => (
          <button key={c.id} className="item" onClick={() => onSelect(c.id)}>
            <div className="name">{c.contact?.displayName || c.phone}</div>
            <div className="preview">{c.phone}</div>
            <div className="meta">{new Date(c.lastMessageAt).toLocaleString()}</div>
          </button>
        ))}
        {filtered.length === 0 && (
          <div className="item">
            <div className="name">No conversations yet</div>
            <div className="preview">Send a message to start a thread.</div>
          </div>
        )}
      </div>
    </div>
  );
}
EOF

cat > frontend/src/components/Thread.jsx <<'EOF'
import React from 'react';

export default function Thread({ thread }) {
  if (!thread) return <div className="thread"><div className="messages">Loading…</div></div>;
  const { contact, messages } = thread;

  return (
    <div className="thread">
      <div className="messages">
        <div style={{ marginBottom: 8, color: '#8696a0' }}>
          Chat with {contact.displayName || contact.phone}
        </div>
        {messages.map(m => (
          <div key={m.id} className={m.direction === 'in' ? 'msg in' : 'msg out'}>
            <div className="body">
              {m.type === 'text' && m.body}
              {m.type !== 'text' && (m.mediaUrl ? `Media: ${m.mediaUrl}` : `[${m.type}]`)}
            </div>
            <div className="time">{new Date(m.createdAt).toLocaleTimeString()}</div>
          </div>
        ))}
      </div>
    </div>
  );
}
EOF

cat > frontend/src/components/Composer.jsx <<'EOF'
import React, { useState } from 'react';
import { sendMessage } from '../api';

export default function Composer({ toPhone, onSent }) {
  const [text, setText] = useState('');
  const [sending, setSending] = useState(false);

  async function handleSend() {
    const msg = text.trim();
    if (!msg || !toPhone) return;
    setSending(true);
    const { ok } = await sendMessage(toPhone, msg);
    setSending(false);
    if (ok) {
      setText('');
      onSent?.();
    } else {
      alert('Send failed. Check your API keys and messaging window rules.');
    }
  }

  function onKeyDown(e) {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  }

  return (
    <div className="composer">
      <textarea
        className="textarea"
        placeholder="Type a message… (Enter to send)"
        value={text}
        onChange={e => setText(e.target.value)}
        onKeyDown={onKeyDown}
      />
      <button className="button" onClick={handleSend} disabled={sending}>Send</button>
    </div>
  );
}
EOF

cat > frontend/src/App.jsx <<'EOF'
import React, { useEffect, useState } from 'react';
import './styles.css';
import Sidebar from './components/Sidebar';
import Thread from './components/Thread';
import Composer from './components/Composer';
import { Store } from './store';

const store = new Store((s) => setState({ ...s }));

export default function App() {
  const [state, setState] = useState(store.state);

  useEffect(() => { store.load(); }, []);

  const activePhone = (() => {
    const conv = state.conversations.find(c => c.id === state.activeId);
    return conv?.phone;
  })();

  return (
    <div className="app">
      <Sidebar
        conversations={state.conversations}
        search={state.search}
        onSearch={(q) => store.setSearch(q)}
        onSelect={(id) => store.setActive(id)}
      />
      <div>
        <Thread thread={state.activeThread} />
        <Composer toPhone={activePhone} onSent={() => { /* WS updates */ }} />
      </div>
    </div>
  );
}
EOF

cat > frontend/src/main.jsx <<'EOF'
import React from 'react';
import { createRoot } from 'react-dom/client';
import App from './App';

createRoot(document.getElementById('root')).render(<App />);
EOF

echo "✅ Project files created at $(pwd)"
echo "Next steps:"
echo "1) cd backend && cp .env.example .env && edit .env with your tokens"
echo "2) npm install && npm run dev"
echo "3) Open new terminal: cd frontend && npm install && npm run dev"
echo "4) Configure your webhook to POST to http://YOUR_PUBLIC_URL/webhook"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                int scratch = randInt(0,3);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            s.Health -= scratch;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return {true, "Nothing found. Scrape (-" + to_string(scratch) + " health)."};
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        pair<bool,string> Skip(Stats&) { return {true, "Saving energy for night."}; }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        namespace Night {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            void Resolve(Stats& s) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    s.Night += 1;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            // Baseline
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    s.Hunger += 10;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            s.Energy -= 10;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Traps
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (s.Traps > 0) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        int caught = 0;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    for (int i=0;i<s.Traps;i++) if (rand01() < 0.35) caught++;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                s.Food += caught;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if (caught > 0) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cout << "Your traps caught " << caught << " food.\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                       int coldDmg = max(0, 8 - s.Shelter);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        s.Health -= coldDmg;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cout << "A cold wind howls (-" << coldDmg << " health).\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    // Wolves
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            double wolfBase = 0.10 + (s.Night * 0.005);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (rand01() < wolfBase) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                int dmg = max(2, 18 - (s.Shelter * 2));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            s.Health -= dmg;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cout << "Wolves circle your camp! (-" << dmg << " health)\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    if (s.Wood >= 2) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    s.Wood -= 2;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cout << "You burn extra wood to deter them (-2 wood).\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                // Starvation / fatigue
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        if (s.Hunger >= 90) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    s.Health -= 8;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cout << "Starvation gnaws at you (-8 health).\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                if (s.Energy <= 10) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            s.Health -= 5;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cout << "Exhaustion sets in (-5 health).\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    struct Game {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        Stats s;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            int actionsLeft = 2; // day actions per day
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                string phase = "Day"; // "Day" or "Night"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                };

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                void renderHUD(const Stats& s) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cout << "\n=== Forest 99 ===\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cout << "Night: " << s.Night << "\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cout << "Health: " << s.Health << " | Hunger: " << s.Hunger << " | Energy: " << s.Energy << "\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cout << "Wood: " << s.Wood << " | Food: " << s.Food << " | Shelter: " << s.Shelter << " | Traps: " << s.Traps << "\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                void renderActions(int actionsLeft) {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cout << "\nActions left: " << actionsLeft << "\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cout << "1) GatherWood\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cout << "2) Forage\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cout << "3) Rest\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cout << "4) Cook\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cout << "5) CraftShelter\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cout << "6) SetTrap\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                cout << "7) EatNow\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    cout << "8) Scout\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        cout << "9) Skip\n";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            cout << "Choose: ";
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            bool handleAction
