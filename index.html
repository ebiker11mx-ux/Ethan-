<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>3D Obby – Double Jump + Levels</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <style>
    html, body { width:100%; height:100%; margin:0; overflow:hidden; background:#0b0f1a; }
    #renderCanvas { width:100%; height:100%; touch-action:none; display:block; }
    .hud { position:fixed; inset:0; pointer-events:none; }
    .button { position:absolute; pointer-events:auto; border:none; outline:none; color:#fff; font-weight:700; border-radius:14px;
      background:linear-gradient(135deg, #1e88e5, #6a1b9a); box-shadow:0 6px 16px rgba(0,0,0,0.4); }
    #restartBtn { top:16px; left:16px; padding:10px 14px; font-size:14px; }
    #switchMenuBtn { top:16px; left:110px; padding:10px 14px; font-size:14px; }
    #jumpBtn { bottom:28px; right:24px; width:74px; height:74px; font-size:14px; border-radius:50%; }
    #info { position:absolute; top:16px; right:16px; color:#bfe9ff; font-size:12px; background:rgba(0,0,0,0.35); padding:8px 10px; border-radius:10px; }
    #winBanner { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(0,0,0,0.7); color:#fff;
      padding:18px 22px; border-radius:12px; font-size:18px; display:none; pointer-events:auto; text-align:center; }
    #levelMenu { position:fixed; inset:0; background:rgba(3,6,14,0.8); display:flex; align-items:center; justify-content:center; }
    .menuCard { background:#121a2b; border-radius:16px; padding:20px; max-width:420px; width:90%; text-align:center; }
    .levelBtn { margin:8px; padding:12px 14px; border-radius:12px; color:#fff; font-weight:800; border:none; cursor:pointer; }
    .easy { background:linear-gradient(135deg, #2e8f5d, #3aa884); }
    .hard { background:linear-gradient(135deg, #e6a86b, #b96a1b); }
    .impossible { background:linear-gradient(135deg, #7a2b58, #c0366f); }
    #joystick { position:absolute; bottom:22px; left:22px; width:140px; height:140px; pointer-events:auto; }
    .joy-bg { position:absolute; width:100%; height:100%; border-radius:50%; background:rgba(255,255,255,0.08); }
    .joy-stick { position:absolute; left:50%; top:50%; width:70px; height:70px; transform:translate(-50%, -50%); border-radius:50%; background:rgba(255,255,255,0.18); }
  </style>
</head>
<body>
  <canvas id="renderCanvas"></canvas>

  <div id="levelMenu">
    <div class="menuCard">
      <h2>Pick your challenge</h2>
      <button class="levelBtn easy" data-level="easy">Easy</button>
      <button class="levelBtn hard" data-level="hard">Hard</button>
      <button class="levelBtn impossible" data-level="impossible">Impossible</button>
    </div>
  </div>

  <div class="hud">
    <button id="restartBtn" class="button">Restart</button>
    <button id="switchMenuBtn" class="button">Levels</button>
    <button id="jumpBtn" class="button">Jump</button>
    <div id="joystick"><div class="joy-bg"></div><div class="joy-stick" id="joyStick"></div></div>
    <div id="winBanner">You win! Time: <span id="winTime">0.0</span>s</div>
    <div id="info">Level: <span id="levelName">—</span> | Time: <span id="timer">0.0</span>s</div>
  </div>

  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script>
    const canvas = document.getElementById("renderCanvas");
    const engine = new BABYLON.Engine(canvas, true);

    let scene, player, followCam;
    let currentLevel = null;
    let won = false, startTime = 0;

    const playerState = {
      radius: 0.5, pos: new BABYLON.Vector3(0,2,0), vel: new BABYLON.Vector3(0,0,0),
      speed: 7.5, jumpPower: 10.5, gravity: -22.0, grounded: false,
      jumpsUsed: 0, maxJumps: 2
    };

    function createScene() {
      scene = new BABYLON.Scene(engine);
      new BABYLON.HemisphericLight("light", new BABYLON.Vector3(0,1,0), scene);
      player = BABYLON.MeshBuilder.CreateSphere("player",{diameter:playerState.radius*2},scene);
      player.position.copyFrom(playerState.pos);
      followCam = new BABYLON.FollowCamera("cam", player.position, scene);
      followCam.lockedTarget = player;
      followCam.attachControl(canvas,true);
      return scene;
    }

    function buildLevel(level) {
      scene.meshes.forEach(m=>{ if(m.name!=="player") m.dispose(); });
      document.getElementById("levelName").textContent = level;
      let z=10;
      BABYLON.MeshBuilder.CreateGround("ground",{width:20,height:20},scene);
      BABYLON.MeshBuilder.CreateBox("platform",{width:6,height:1,depth:6},scene).position=new BABYLON.Vector3(0,1,z);
      z+=10;
      BABYLON.MeshBuilder.CreateBox("goal",{width:6,height:2,depth:6},scene).position=new BABYLON.Vector3(0,2,z);
      resetPlayer(true);
    }

    function resetPlayer(resetTimer=false){
      won=false;
      playerState.pos.copyFrom(new BABYLON.Vector3(0,2,0));
      playerState.vel.copyFrom(new BABYLON.Vector3(0,0,0));
      playerState.grounded=false; playerState.jumpsUsed=0;
      player.position.copyFrom(playerState.pos);
      if(resetTimer) startTime=performance.now();
    }

    function tryJump(){
      if(playerState.grounded || playerState.jumpsUsed<playerState.maxJumps){
        playerState.vel.y=playerState.jumpPower;
        playerState.grounded=false;
        playerState.jumpsUsed++;
      }
    }

    document.querySelectorAll(".levelBtn").forEach(btn=>{
      btn.addEventListener("click",()=>{
        currentLevel=btn.dataset.level;
        document.getElementById("levelMenu").style.display="none";
        buildLevel(currentLevel);
      });
    });
    document.getElementById("switchMenuBtn").onclick=()=>document.getElementById("levelMenu").style.display="flex";
    document.getElementById("restartBtn").onclick=()=>resetPlayer(true);
    document.getElementById("jumpBtn").onclick=tryJump;

    const sceneInstance=createScene();
    engine.runRenderLoop(()=>{
      const delta=scene.getEngine().getDeltaTime()/1000;
      playerState.vel.y+=playerState.gravity*delta;
      playerState.pos.addInPlace(playerState.vel.scale(delta));
      if(playerState.pos.y<0){resetPlayer();}
      player.position.copyFrom(playerState.pos);
      scene.render();
      if(currentLevel){
        const t=(performance.now()-startTime)/1000;
        document.getElementById("timer").textContent=t.toFixed(1);
      }
    });
    window.addEventListener("resize",()=>engine.resize());
  </script>
</body>
</html>
