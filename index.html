-- ServerScriptService/Forest99Setup.lua
-- One-shot bootstrap: creates modules, remotes, server loop, and client UI.

local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local ServerScriptService = game:GetService("ServerScriptService")
local StarterPlayer = game:GetService("StarterPlayer")
local StarterGui = game:GetService("StarterGui")

-- Ensure folders
local ModulesFolder = ReplicatedStorage:FindFirstChild("Modules") or Instance.new("Folder", ReplicatedStorage)
ModulesFolder.Name = "Modules"

-- Create RemoteEvents
local ActionEvent = ReplicatedStorage:FindFirstChild("ActionEvent") or Instance.new("RemoteEvent", ReplicatedStorage)
ActionEvent.Name = "ActionEvent"
local StateEvent = ReplicatedStorage:FindFirstChild("StateEvent") or Instance.new("RemoteEvent", ReplicatedStorage)
StateEvent.Name = "StateEvent"

-- Helper to create ModuleScript
local function ensureModule(name, source)
    local m = ModulesFolder:FindFirstChild(name)
        if not m then
                m = Instance.new("ModuleScript")
                        m.Name = name
                                m.Source = source
                                        m.Parent = ModulesFolder
                                            else
                                                    m.Source = source
                                                        end
                                                            return m
                                                            end

                                                            -- Helper to create Scripts
                                                            local function ensureServerScript(name, parent, source)
                                                                local s = parent:FindFirstChild(name)
                                                                    if not s then
                                                                            s = Instance.new("Script")
                                                                                    s.Name = name
                                                                                            s.Source = source
                                                                                                    s.Parent = parent
                                                                                                        else
                                                                                                                s.Source = source
                                                                                                                    end
                                                                                                                        return s
                                                                                                                        end

                                                                                                                        local function ensureLocalScript(name, parent, source)
                                                                                                                            local s = parent:FindFirstChild(name)
                                                                                                                                if not s then
                                                                                                                                        s = Instance.new("LocalScript")
                                                                                                                                                s.Name = name
                                                                                                                                                        s.Source = source
                                                                                                                                                                s.Parent = parent
                                                                                                                                                                    else
                                                                                                                                                                            s.Source = source
                                                                                                                                                                                end
                                                                                                                                                                                    return s
                                                                                                                                                                                    end

                                                                                                                                                                                    -- Stats module
                                                                                                                                                                                    ensureModule("Stats", [[
                                                                                                                                                                                    local Stats = {}

                                                                                                                                                                                    function Stats.new()
                                                                                                                                                                                    	return {
                                                                                                                                                                                        		Health = 100,
                                                                                                                                                                                                		Hunger = 0,
                                                                                                                                                                                                        		Energy = 100,
                                                                                                                                                                                                                		Wood = 0,
                                                                                                                                                                                                                        		Food = 0,
                                                                                                                                                                                                                                		Shelter = 0,
                                                                                                                                                                                                                                        		Traps = 0,
                                                                                                                                                                                                                                                		Night = 0,
                                                                                                                                                                                                                                                        	}
                                                                                                                                                                                                                                                            end

                                                                                                                                                                                                                                                            function Stats.Clamp(s)
                                                                                                                                                                                                                                                            	s.Health = math.clamp(s.Health, 0, 100)
                                                                                                                                                                                                                                                                	s.Hunger = math.clamp(s.Hunger, 0, 100)
                                                                                                                                                                                                                                                                    	s.Energy = math.clamp(s.Energy, 0, 100)
                                                                                                                                                                                                                                                                        	s.Shelter = math.max(s.Shelter, 0)
                                                                                                                                                                                                                                                                            end

                                                                                                                                                                                                                                                                            return Stats
                                                                                                                                                                                                                                                                            ]])

                                                                                                                                                                                                                                                                            -- Actions module
                                                                                                                                                                                                                                                                            ensureModule("Actions", [[
                                                                                                                                                                                                                                                                            local Actions = {}

                                                                                                                                                                                                                                                                            local function randInt(a, b)
                                                                                                                                                                                                                                                                            	return math.random(a, b)
                                                                                                                                                                                                                                                                                end

                                                                                                                                                                                                                                                                                function Actions.GatherWood(s)
                                                                                                                                                                                                                                                                                	if s.Energy < 15 then return false, "Too tired." end
                                                                                                                                                                                                                                                                                    	s.Energy -= 15
                                                                                                                                                                                                                                                                                        	local w = randInt(3, 7)
                                                                                                                                                                                                                                                                                            	s.Wood += w
                                                                                                                                                                                                                                                                                                	return true, ("Gathered %d wood."):format(w)
                                                                                                                                                                                                                                                                                                    end

                                                                                                                                                                                                                                                                                                    function Actions.Forage(s)
                                                                                                                                                                                                                                                                                                    	if s.Energy < 20 then return false, "Too tired." end
                                                                                                                                                                                                                                                                                                        	s.Energy -= 20
                                                                                                                                                                                                                                                                                                            	local f = randInt(1, 4)
                                                                                                                                                                                                                                                                                                                	local thorn = randInt(0, 5)
                                                                                                                                                                                                                                                                                                                    	s.Food += f
                                                                                                                                                                                                                                                                                                                        	s.Health -= thorn
                                                                                                                                                                                                                                                                                                                            	return true, ("Found %d food. Thorns (-%d health)."):format(f, thorn)
                                                                                                                                                                                                                                                                                                                                end

                                                                                                                                                                                                                                                                                                                                function Actions.Rest(s)
                                                                                                                                                                                                                                                                                                                                	local gain = randInt(20, 35)
                                                                                                                                                                                                                                                                                                                                    	s.Energy += gain
                                                                                                                                                                                                                                                                                                                                        	s.Hunger += 5
                                                                                                                                                                                                                                                                                                                                            	return true, ("Rested, +%d energy. Hunger +5."):format(gain)
                                                                                                                                                                                                                                                                                                                                                end

                                                                                                                                                                                                                                                                                                                                                function Actions.Cook(s)
                                                                                                                                                                                                                                                                                                                                                	if s.Energy < 10 then return false, "Too tired." end
                                                                                                                                                                                                                                                                                                                                                    	if s.Food <= 0 then return false, "No food to cook." end
                                                                                                                                                                                                                                                                                                                                                        	s.Energy -= 10
                                                                                                                                                                                                                                                                                                                                                            	local cookQty = math.min(s.Food, 3)
                                                                                                                                                                                                                                                                                                                                                                	s.Food -= cookQty
                                                                                                                                                                                                                                                                                                                                                                    	s.Food += cookQty * 2
                                                                                                                                                                                                                                                                                                                                                                        	return true, ("Cooked %d food (counts double at night)."):format(cookQty)
                                                                                                                                                                                                                                                                                                                                                                            end

                                                                                                                                                                                                                                                                                                                                                                            function Actions.CraftShelter(s)
                                                                                                                                                                                                                                                                                                                                                                            	if s.Energy < 25 then return false, "Too tired." end
                                                                                                                                                                                                                                                                                                                                                                                	if s.Wood < 6 then return false, "Need 6 wood." end
                                                                                                                                                                                                                                                                                                                                                                                    	if s.Shelter >= 10 then return false, "Shelter maxed." end
                                                                                                                                                                                                                                                                                                                                                                                        	s.Energy -= 25
                                                                                                                                                                                                                                                                                                                                                                                            	s.Wood -= 6
                                                                                                                                                                                                                                                                                                                                                                                                	s.Shelter += 1
                                                                                                                                                                                                                                                                                                                                                                                                    	return true, ("Shelter reinforced. Now %d."):format(s.Shelter)
                                                                                                                                                                                                                                                                                                                                                                                                        end

                                                                                                                                                                                                                                                                                                                                                                                                        function Actions.SetTrap(s)
                                                                                                                                                                                                                                                                                                                                                                                                        	if s.Energy < 10 then return false, "Too tired." end
                                                                                                                                                                                                                                                                                                                                                                                                            	if s.Wood < 2 then return false, "Need 2 wood." end
                                                                                                                                                                                                                                                                                                                                                                                                                	s.Energy -= 10
                                                                                                                                                                                                                                                                                                                                                                                                                    	s.Wood -= 2
                                                                                                                                                                                                                                                                                                                                                                                                                        	s.Traps += 1
                                                                                                                                                                                                                                                                                                                                                                                                                            	return true, ("Trap set. Total %d."):format(s.Traps)
                                                                                                                                                                                                                                                                                                                                                                                                                                end

                                                                                                                                                                                                                                                                                                                                                                                                                                function Actions.EatNow(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                	if s.Energy < 5 then return false, "Too tired." end
                                                                                                                                                                                                                                                                                                                                                                                                                                    	if s.Food <= 0 then return false, "No food." end
                                                                                                                                                                                                                                                                                                                                                                                                                                        	s.Energy -= 5
                                                                                                                                                                                                                                                                                                                                                                                                                                            	s.Food -= 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                	s.Hunger = math.max(0, s.Hunger - 20)
                                                                                                                                                                                                                                                                                                                                                                                                                                                    	return true, "Ate a meal. Hunger -20."
                                                                                                                                                                                                                                                                                                                                                                                                                                                        end

                                                                                                                                                                                                                                                                                                                                                                                                                                                        function Actions.Scout(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                        	if s.Energy < 10 then return false, "Too tired." end
                                                                                                                                                                                                                                                                                                                                                                                                                                                            	s.Energy -= 10
                                                                                                                                                                                                                                                                                                                                                                                                                                                                	local chance = 0.25 + randInt(0, 10)/100
                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	if math.random() < chance then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        		local w = randInt(2, 5)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		local f = randInt(1, 3)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        		s.Wood += w; s.Food += f
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		return true, ("Cache found! +%d wood, +%d food."):format(w, f)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	else
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            		local scratch = randInt(0, 3)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    		s.Health -= scratch
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            		return true, ("Nothing found. Scrape (-%d health)."):format(scratch)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return Actions
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ]])

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -- Night module
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ensureModule("Night", [[
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local Night = {}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local function randInt(a, b)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	return math.random(a, b)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            function Night.Resolve(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	s.Night += 1

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	s.Hunger += 10
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	s.Energy -= 10

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	if s.Traps > 0 then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            		local caught = 0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    		for i = 1, s.Traps do
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            			if math.random() < 0.35 then caught += 1 end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        		end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		s.Food += caught
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	if s.Hunger >= 60 and s.Food > 0 then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		local meals = math.min(2, s.Food)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        		s.Food -= meals
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		s.Hunger = math.max(0, s.Hunger - meals * 25)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	local cold = randInt(0, 1) == 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	if cold then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    		local coldDmg = math.max(0, 8 - s.Shelter)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            		s.Health -= coldDmg
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	local wolfBase = 0.10 + (s.Night * 0.005)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	if math.random() < wolfBase then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		local dmg = math.max(2, 18 - (s.Shelter * 2))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        		s.Health -= dmg
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		if s.Wood >= 2 then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        			s.Wood -= 2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    		end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	if s.Hunger >= 90 then s.Health -= 8 end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	if s.Energy <= 10 then s.Health -= 5 end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        return Night
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ]])

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -- Server game loop script
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ensureServerScript("GameServer", ServerScriptService, [[
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local Players = game:GetService("Players")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local ReplicatedStorage = game:GetService("ReplicatedStorage")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local Stats = require(ReplicatedStorage.Modules.Stats)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local Actions = require(ReplicatedStorage.Modules.Actions)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local Night = require(ReplicatedStorage.Modules.Night)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local ActionEvent = ReplicatedStorage:WaitForChild("ActionEvent")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local StateEvent = ReplicatedStorage:WaitForChild("StateEvent")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local dayActionsPerDay = 2
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local playerState = {}

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local function broadcastState(plr)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	StateEvent:FireClient(plr, playerState[plr].stats)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            local function startRun(plr)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	playerState[plr] = {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		stats = Stats.new(),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        		actionsLeft = dayActionsPerDay,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		phase = "Day",
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	broadcastState(plr)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                Players.PlayerAdded:Connect(function(plr)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	startRun(plr)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    end)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    Players.PlayerRemoving:Connect(function(plr)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	playerState[plr] = nil
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ActionEvent.OnServerEvent:Connect(function(plr, actionName)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	local state = playerState[plr]
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	if not state then return end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	local s = state.stats
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	if state.phase ~= "Day" then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        		StateEvent:FireClient(plr, s, "Its nightwait until morning.")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		return
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	local ok, msg
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	if actionName == "GatherWood" then ok, msg = Actions.GatherWood(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	elseif actionName == "Forage" then ok, msg = Actions.Forage(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	elseif actionName == "Rest" then ok, msg = Actions.Rest(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	elseif actionName == "Cook" then ok, msg = Actions.Cook(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	elseif actionName == "CraftShelter" then ok, msg = Actions.CraftShelter(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	elseif actionName == "SetTrap" then ok, msg = Actions.SetTrap(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	elseif actionName == "EatNow" then ok, msg = Actions.EatNow(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	elseif actionName == "Scout" then ok, msg = Actions.Scout(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	elseif actionName == "Skip" then ok, msg = true, "Saving energy for night."
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	else ok, msg = false, "Unknown action." end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	if ok then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            		state.actionsLeft -= 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    		if actionName == "Skip" then state.actionsLeft = 0 end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	Stats.Clamp(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	broadcastState(plr)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	StateEvent:FireClient(plr, s, msg)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	if state.actionsLeft <= 0 then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		state.phase = "Night"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        		Night.Resolve(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		Stats.Clamp(s)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        		local summary = ("Night %d ended. Health %d | Hunger %d | Energy %d")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                			:format(s.Night, s.Health, s.Hunger, s.Energy)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            		StateEvent:FireClient(plr, s, summary)

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    		if s.Health <= 0 then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            			StateEvent:FireClient(plr, s, ("You succumbed after %d night(s)."):format(s.Night))
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        			startRun(plr)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    			return
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        		if s.Night >= 99 then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                			StateEvent:FireClient(plr, s, "Dawn on day 100. You survived the forest!")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            			startRun(plr)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        			return
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    		end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            		state.phase = "Day"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    		state.actionsLeft = dayActionsPerDay
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            		broadcastState(plr)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ]])

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        -- Client UI script
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local StarterPlayerScripts = StarterPlayer:WaitForChild("StarterPlayerScripts")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ensureLocalScript("ClientUI", StarterPlayerScripts, [[
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local ReplicatedStorage = game:GetService("ReplicatedStorage")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local Players = game:GetService("Players")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local player = Players.LocalPlayer

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local ActionEvent = ReplicatedStorage:WaitForChild("ActionEvent")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local StateEvent = ReplicatedStorage:WaitForChild("StateEvent")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local screen = Instance.new("ScreenGui")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        screen.ResetOnSpawn = false
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        screen.Name = "Forest99HUD"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        screen.Parent = player:WaitForChild("PlayerGui")

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local statsLabel = Instance.new("TextLabel")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        statsLabel.Size = UDim2.new(0, 380, 0, 110)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        statsLabel.Position = UDim2.new(0, 10, 0, 10)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        statsLabel.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        statsLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        statsLabel.BackgroundTransparency = 0.4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        statsLabel.TextScaled = true
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        statsLabel.Font = Enum.Font.Gotham
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        statsLabel.Name = "Stats"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        statsLabel.Parent = screen

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local msgLabel = Instance.new("TextLabel")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msgLabel.Size = UDim2.new(0, 480, 0, 60)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msgLabel.Position = UDim2.new(0, 10, 0, 130)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msgLabel.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msgLabel.TextColor3 = Color3.fromRGB(230, 230, 230)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msgLabel.BackgroundTransparency = 0.4
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msgLabel.TextScaled = true
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msgLabel.Font = Enum.Font.Gotham
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msgLabel.Name = "Message"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        msgLabel.Parent = screen

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        local actions = {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	"GatherWood","Forage","Rest","Cook","CraftShelter","SetTrap","EatNow","Scout","Skip"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            local buttonFrame = Instance.new("Frame")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buttonFrame.Size = UDim2.new(0, 500, 0, 180)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buttonFrame.Position = UDim2.new(0, 10, 0, 200)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buttonFrame.BackgroundTransparency = 1
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buttonFrame.Name = "Buttons"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            buttonFrame.Parent = screen

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            for i, name in ipairs(actions) do
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	local btn = Instance.new("TextButton")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	btn.Size = UDim2.new(0, 150, 0, 36)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	btn.Position = UDim2.new(0, ((i-1)%3)*160, 0, math.floor((i-1)/3)*40)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	btn.Text = name
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	btn.BackgroundColor3 = Color3.fromRGB(40, 80, 40)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                	btn.TextColor3 = Color3.fromRGB(240, 240, 240)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	btn.Font = Enum.Font.GothamBold
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	btn.Parent = buttonFrame
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	btn.MouseButton1Click:Connect(function()
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		ActionEvent:FireServer(name)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	end)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            local function renderStats(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            	statsLabel.Text = ("Night: %d\nHealth: %d | Hunger: %d | Energy: %d\nWood: %d | Food: %d | Shelter: %d | Traps: %d")
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                		:format(s.Night, s.Health, s.Hunger, s.Energy, s.Wood, s.Food, s.Shelter, s.Traps)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        StateEvent.OnClientEvent:Connect(function(s, msg)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	if typeof(s) == "table" then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            		renderStats(s)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        	if msg then
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            		msgLabel.Text = msg
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    	end
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        end)
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        ]])

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        print("Forest99 setup complete: Modules, Remotes, Server and Client scripts are ready.")